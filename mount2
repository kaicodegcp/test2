cleanup_storage.sh
#!/bin/bash

echo "==> Unmounting existing /data/* mounts..."
for i in /data/{1..11}; do
  umount -f "$i" 2>/dev/null
done

echo "==> Wiping old partitions and signatures on /dev/sd[b-l]..."
for disk in /dev/sd{b..l}; do
  echo "  -> Cleaning $disk"
  wipefs -a "$disk"
done

echo "==> Cleanup complete. RAID and filesystem will be rebuilt in the next script."


====
build_filesystem_layout.sh

#!/bin/bash
set -e

echo "==> Creating Physical Volumes on 10 hardware RAID disks..."
pvcreate /dev/sd{b..k}

echo "==> Creating Volume Group 'datavg'..."
vgcreate datavg /dev/sd{b..k}

echo "==> Creating Logical Volumes..."
lvcreate -n lv_app_log -L 7.2T datavg
lvcreate -n lv_opt_cloudera -L 100G datavg
lvcreate -n lv_Opt_Cloudera -L 100G datavg
lvcreate -n lv_ozone_metadata -L 7.2T datavg
lvcreate -n lv_recon_data -L 7.2T datavg

echo "==> Formatting Logical Volumes with ext4..."
for lv in lv_app_log lv_opt_cloudera lv_Opt_Cloudera lv_ozone_metadata lv_recon_data; do
  mkfs.ext4 "/dev/datavg/$lv"
done

echo "==> Creating required mount directories..."
mkdir -p /var/app/log
mkdir -p /opt/cloudera
mkdir -p /opt/Cloudera
mkdir -p /var/app/lib/hadoop-ozone/recon/ozone-metadata
mkdir -p /var/app/lib/hadoop-ozone/recon/data
mkdir -p /var/app/lib/hadoop-ozone/recon/om/data
mkdir -p /var/app/lib/hadoop-ozone/recon/scm/data

echo "==> Updating /etc/fstab for persistent mounts..."
cat <<EOF >> /etc/fstab
/dev/datavg/lv_app_log           /var/app/log                                     ext4 defaults 0 2
/dev/datavg/lv_opt_cloudera      /opt/cloudera                                    ext4 defaults 0 2
/dev/datavg/lv_Opt_Cloudera      /opt/Cloudera                                    ext4 defaults 0 2
/dev/datavg/lv_ozone_metadata    /var/app/lib/hadoop-ozone/recon/ozone-metadata   ext4 defaults 0 2
/dev/datavg/lv_recon_data        /var/app/lib/hadoop-ozone/recon/data             ext4 defaults 0 2
EOF

echo "==> Mounting filesystems..."
mount -a

echo "✅ Filesystem layout created successfully for RHEL 8 with hardware RAID."


missing
=======

#!/bin/bash
set -e

echo "==> Creating only missing Logical Volumes..."
lvcreate -n lv_app_lib -L 100G datavg
lvcreate -n lv_recon_om_data -L 7.2T datavg
lvcreate -n lv_recon_scm_data -L 7.2T datavg

echo "==> Formatting new Logical Volumes as ext4..."
mkfs.ext4 /dev/datavg/lv_app_lib
mkfs.ext4 /dev/datavg/lv_recon_om_data
mkfs.ext4 /dev/datavg/lv_recon_scm_data

echo "==> Creating missing mount directories..."
mkdir -p /var/app/lib
mkdir -p /var/app/lib/hadoop-ozone/recon/om/data
mkdir -p /var/app/lib/hadoop-ozone/recon/scm/data

echo "==> Updating /etc/fstab for newly added LVs..."
cat <<EOF >> /etc/fstab
/dev/datavg/lv_app_lib           /var/app/lib                                     ext4 defaults 0 2
/dev/datavg/lv_recon_om_data     /var/app/lib/hadoop-ozone/recon/om/data          ext4 defaults 0 2
/dev/datavg/lv_recon_scm_data    /var/app/lib/hadoop-ozone/recon/scm/data         ext4 defaults 0 2
EOF

echo "==> Mounting the new filesystems..."
mount /var/app/lib
mount /var/app/lib/hadoop-ozone/recon/om/data
mount /var/app/lib/hadoop-ozone/recon/scm/data

echo "✅ Only missing LVs have been added and mounted successfully."


---------------------
#!/bin/bash
set -e

echo "==> Creating mount point directories if they do not exist..."
mkdir -p /var/app/lib/hadoop-ozone/recon/ozone-metadata
mkdir -p /var/app/lib/hadoop-ozone/recon/data
mkdir -p /var/app/lib/hadoop-ozone/recon/om/data
mkdir -p /var/app/lib/hadoop-ozone/recon/scm/data

echo "==> Mounting the missing LVs..."
mount /dev/datavg/lv_ozone_metadata /var/app/lib/hadoop-ozone/recon/ozone-metadata
mount /dev/datavg/lv_recon_data /var/app/lib/hadoop-ozone/recon/data
mount /dev/datavg/lv_recon_om_data /var/app/lib/hadoop-ozone/recon/om/data
mount /dev/datavg/lv_recon_scm_data /var/app/lib/hadoop-ozone/recon/scm/data

echo "==> Adding to /etc/fstab..."
cat <<EOF >> /etc/fstab
/dev/datavg/lv_ozone_metadata    /var/app/lib/hadoop-ozone/recon/ozone-metadata   ext4 defaults 0 2
/dev/datavg/lv_recon_data        /var/app/lib/hadoop-ozone/recon/data             ext4 defaults 0 2
/dev/datavg/lv_recon_om_data     /var/app/lib/hadoop-ozone/recon/om/data          ext4 defaults 0 2
/dev/datavg/lv_recon_scm_data    /var/app/lib/hadoop-ozone/recon/scm/data         ext4 defaults 0 2
EOF

echo "✅ Missing RECON volumes mounted and persisted successfully."

